@using Microsoft.AspNetCore.Http
@using Microsoft.Extensions.Configuration

@inject IConfiguration Config
@model Seqrus.Web.Helpers.ComplianceSettings
@{
    ViewData["Title"] = "Risks";
}

<div class="row">
    <div class="col-md-9" role="main">
        <h1 class="page-header">Risks</h1>
        <section class="seq-section">
            <p>Here are some of the OWASP risks that have been addressed in this web application.</p>
            <p>Legend:</p>
            <dl class="dl-horizontal">
                <dt><risk-exposure /></dt>
                <dd>Means that this risk has not been intentionally addressed in this application.</dd>

                <dt><risk-exposure is-exposed="true"/></dt>
                <dd>Means that this risk has been addressed in this application, in a way that makes the application intentionally susceptible to the risk.</dd>

                <dt><risk-exposure is-exposed="false"/></dt>
                <dd>Means that this risk has been addressed in this application, in a way that demonstrably addresses some or all aspects of the risk.</dd>
            </dl>
        </section>

        <section id="a1" class="seq-section">
            <h2 class="page-header">A1:2017 - Injection <risk-exposure /></h2>
            <read-more href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" />
        </section>

        <section id="a2" class="seq-section">
            <h2 class="page-header">A2:2017 - Broken Authentication and Session Management <risk-exposure /></h2>
            <read-more href="https://www.owasp.org/index.php/Top_10-2017_A2-Broken_Authentication" />
        </section>

        <section id="a3" class="seq-section">
            <h2 class="page-header">A3:2017 - Sensitive Data Exposure <risk-exposure is-exposed="Model.SensitiveDataExposure"/></h2>
            <div class="seq-description">
                <p>Your data is probably important to you, so you should take adequate measures to protect it (e.g. by encrypting it), both in transit and at rest.</p>
                <p>Exposure to this risk means that an attacker can gain unauthorized access to your data.</p>
                
                <blockquote cite="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">
                    <p>Over the last few years, this has been the most common impactful attack. The most common flaw is simply not encrypting sensitive data.</p>
                    <footer><a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure">The OWASP Top 10 2017 Project</a></footer>
                </blockquote>
            </div>

            <div class="seq-test">
                <div class="panel panel-default">
                    <div class="panel-heading">Check the Strict-Transport-Security response header</div>
                    <div class="panel-body">
                        Use the developer tools of your browser to inspect the HTTP response headers when making any request to this application.
                        <ul>
                            <li>If <risk-exposure is-exposed="true" />, the <code>Strict-Transport-Security</code> header will not be present, meaning that communication might not be encrypted.</li>
                            <li>If <risk-exposure is-exposed="false" />, the <code>Strict-Transport-Security</code> header will be present and configured in a way that instructs the client to use HTTPS on subsequent requests.</li>
                        </ul>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Check the Cache-Control response header</div>
                    <div class="panel-body">
                        Use the developer tools of your browser to inspect the HTTP response headers when <a asp-controller="Risk" asp-action="Secrets">viewing sensitive information on this application</a>.
                        <ul>
                            <li>If <risk-exposure is-exposed="true"/>, the <code>Cache-Control</code> header will not be present, meaning that sensitive data might be cached in the browser or by an intermediary HTTP proxy.</li>
                            <li>If <risk-exposure is-exposed="false"/>, the <code>Cache-Control</code> header will be present and configured in a way that instructs proxies and browsers to not store or use cached responses.</li>
                        </ul>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Check for HTTP-to-HTTPS redirects</div>
                    <div class="panel-body">
                        <div class="alert alert-warning">Note: Before performing this test, <a href="https://really-simple-ssl.com/knowledge-base/clear-hsts-browser/">you should delete any previous HSTS policy settings for this domain from your browser</a>.</div>
                        <a asp-protocol="http" asp-controller="Risk" asp-action="Secrets" asp-host="@(new HostString(Context.Request.Host.Host.Replace(" https", "http" ), Config.GetValue<int>("Bindings:http")))">Click here to attempt to view sensitive secrets over an unencrypted (HTTP) connection</a>.
                        <ul>
                            <li>If <risk-exposure is-exposed="true"/>, sensitive data (information about a client) will be transmitted over an unencrypted connection.</li>
                            <li>If <risk-exposure is-exposed="false"/>, the information will instead be redirected over an encrypted HTTPS connection (as should be indicated by a lock icon near the address field in your browser).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="a4" class="seq-section">
            <h2 class="page-header">A4:2017 - XML External Entity (XXE) <risk-exposure /></h2>

            <read-more href="https://www.owasp.org/index.php/Top_10-2017_A4-XML_External_Entities_(XXE)" />
        </section>

        <section id="a5" class="seq-section">
            <h2 class="page-header">A5:2017 - Broken Access Control <risk-exposure /></h2>

            <read-more href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" />
        </section>

        <section id="a6" class="seq-section">
            <h2 class="page-header">A6:2017 - Security Misconfiguration <risk-exposure is-exposed="Model.SecurityMisconfiguration"/></h2>
            
            <div class="seq-description">
                <p>
                    Exposure to this risk means that an attacker can gain information about the inner workings of your system
                    that can be useful to plan and execute further attacks on it. In more extreme cases, it may compromise the entire system.
                </p>
                <blockquote cite="https://www.owasp.org/index.php/Top_10-2017_A6-Security_Misconfiguration">
                    <p>Attackers will often attempt to exploit unpatched flaws or access default accounts, unused pages, unprotected files and directories, etc to gain unauthorized access or knowledge of the system.</p>
                    <footer><a href="https://www.owasp.org/index.php/Top_10-2017_A6-Security_Misconfiguration">The OWASP Top 10 2017 Project</a></footer>
                </blockquote>
            </div>

            <div class="seq-test">
                <div class="panel panel-default">
                    <div class="panel-heading">Check the response headers for unneccessary information about your environment</div>
                    <div class="panel-body">
                        Use the developer tools of your browser to inspect the HTTP response headers of any request to this application.
                        <ul>
                            <li>If <risk-exposure is-exposed="true"/>, sensitive data (details about the web server software) will leak through the <code>Server</code> header. </li>
                            <li>If <risk-exposure is-exposed="false"/>, the <code>Server</code> header will not be present at all in the response.</li>
                        </ul>
                        <div class="alert alert-info">Other headers, such as the <code>X-Powered-By</code>, <code>X-AspNet-Version</code> and <code>X-AspNetMvc-Version</code> headers, may also expose unneccessary details about your environment that can be of use to an attacker.</div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Check for sensitive information in user-visible error messages</div>
                    <div class="panel-body">
                        <a asp-action="FailDatabaseConnection">Click here to attempt to connect to the database (and fail miserably, resulting in an error message)</a>.
                        <ul>
                            <li>If <risk-exposure is-exposed="true"/>, sensitive data (a connection string including database credentials) will leak through the error message.</li>
                            <li>If <risk-exposure is-exposed="false"/>, a generic error message will be shown without any sensitive information.</li>
                        </ul>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Check for unneccessary details in log-in error messages</div>
                    <div class="panel-body">
                        <a asp-controller="User" asp-action="Index">Login with the incorrect password for the "admin" user</a> and check the contents of the error message.
                        <ul>
                            <li>If <risk-exposure is-exposed="true"/>, the error message will inform you that the user "admin" exists, providing an attacker with useful information.</li>
                            <li>If <risk-exposure is-exposed="false"/>, a generic error message will be shown without any sensitive information.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="a7" class="seq-section">
            <h2 class="page-header">A7:2017 - Cross-Site Scripting (XSS) <risk-exposure is-exposed="Model.CrossSiteScripting"/></h2>
            
            <div class="seq-description">
                <p>Exposure to this risk means an attacker may be able to gain unauthorized access to your application and expose your clients to malicious code.</p>
                
                <blockquote cite="https://www.owasp.org/index.php/Top_10-2017_A7-Cross-Site_Scripting_(XSS)">
                    <p>
                        XSS is the second most prevalent issue in the OWASP Top 10, and is found in around two thirds of all applications. &hellip;
                        
                        The impact of XSS [includes] &hellip; remote code execution on the victim's browser, such as stealing credentials, sessions, or delivering malware to the victim.
                    </p>
                    <footer><a href="https://www.owasp.org/index.php/Top_10-2017_A7-Cross-Site_Scripting_(XSS)">The OWASP Top 10 2017 Project</a></footer>
                </blockquote>
            </div>
            
            <div class="seq-test">
                <div class="panel panel-default">
                    <div class="panel-heading">Check the Content-Security-Policy response header</div>
                    <div class="panel-body">
                        Use the developer tools of your browser to inspect the HTTP response headers of any request to this application.
                        <ul>
                            <li>If <risk-exposure is-exposed="true" />, no <code>Content-Security-Policy</code> header will be present, meaning the client receives no instructions on which sources to trust for content. </li>
                            <li>If <risk-exposure is-exposed="false" />, the <code>Content-Security-Policy</code> header will be present and configured in a way that instructs the client to trust <strong>only</strong> the sources required by this application (i.e. white-listing).</li>
                        </ul>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">Check the X-Frame-Options response header</div>
                    <div class="panel-body">
                        Use the developer tools of your browser to inspect the HTTP response headers of any request to this application.
                        <ul>
                            <li>If <risk-exposure is-exposed="true" />, no <code>X-Frame-Options</code> header will be present, meaning the client receives no restrictions on displaying the application in a <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code> or <code>&lt;object&gt;</code>.</li>
                            <li>If <risk-exposure is-exposed="false" />, the <code>X-Frame-Options</code> header will be present and configured to prevent the client from from displaying the application in a <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code> or <code>&lt;object&gt;</code>.</li>
                        </ul>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">Check if the application loads in an iframe on a different domain</div>
                    <div class="panel-body">
                        Download <a asp-controller="Risk" asp-action="IframeTest">this test page</a> to your device and then open it.
                        <ul>
                            <li>If <risk-exposure is-exposed="true" />, this application will open inside an <code>iframe</code>.</li>
                            <li>If <risk-exposure is-exposed="false" />, the <code>iframe</code> will be empty, indicating that the <code>X-Frame-Options</code> header has prevented your browser from displaying the page.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="a8" class="seq-section">
            <h2 class="page-header">A8:2017 - Insecure Deserialization <risk-exposure /></h2>

            <read-more href="https://www.owasp.org/index.php/Top_10-2017_A8-Insecure_Deserialization" />
        </section>
        <section id="a9" class="seq-section">
            <h2 class="page-header">A9:2017 - Using Components With Known Vulnerabilities <risk-exposure /></h2>

            <read-more href="https://www.owasp.org/index.php/Top_10-2017_A9-Using_Components_with_Known_Vulnerabilities" />
        </section>
    <section id="a10" class="seq-section">
        <h2 class="page-header">A10:2017 - Insufficient Logging and Monitoring <risk-exposure is-exposed="@Model.InsufficientLoggingAndMonitoring" /></h2>
            
        <div class="seq-description">
            <p>
                When your system is being attacked, you want to:
                <ul>
                    <li>Become alerted to the attack so you can activate countermeasures to foil the attacker</li>
                    <li>Determine the source, target, scope and effects of the attack</li>
                    <li>Monitor the attack patterns to adapt for future attacks</li>
                    <li>Collect evidence of the attack to be used for prosecution of the attacker</li>
                </ul>
            </p>
            <p>Exposure to this risk means that an attacker can go undetected in your application and that attacks can be made without fear of prosecution.</p>
            
            <blockquote cite="https://www.owasp.org/index.php/Top_10-2017_A10-Insufficient_Logging%26Monitoring">
                <p>Most successful attacks start with vulnerability probing. Allowing such probes to continue can raise the likelihood of successful exploit to nearly 100%.</p>
                <footer><a href="https://www.owasp.org/index.php/Top_10-2017_A10-Insufficient_Logging%26Monitoring">The OWASP Top 10 2017 Project</a></footer>
            </blockquote>
        </div>
        <div class="seq-test">
            <div class="panel panel-default">
                <div class="panel-heading">Check the logs for failed login attempts</div>
                <div class="panel-body">
                    Attempt to <a asp-controller="User" asp-action="Index">login to the application</a> using invalid credentials, then <a asp-controller="Audit" asp-action="Logs">check the logs for failed attempts</a>.
                    <ul>
                        <li>If <risk-exposure is-exposed="true"/>, the logs contain no information about the failed login attempt, meaning an attacker can attempt to gain unauthorized access to sensitive information without it being noticed.</li>
                        <li>If <risk-exposure is-exposed="false"/>, the logs contain details about the failed login attempt.</li>
                    </ul>
                </div>
            </div>
        </div>
           
    </section>
    <section id="a8-2013" class="seq-section">
        <h2 class="page-header">A8:2013 - Cross-Site Request Forgery (CSRF) <risk-exposure is-exposed="@Model.CrossSiteRequestForgery" /></h2>
        <div class="seq-description">
            <p>
                Even though CSRF has dropped off the OWASP top 10 list, it is still relevant to test for it.
            </p>
            <p>
                Exposure to this risk means that an attacker can impersonate your users,
                thereby gaining unauthorized access to information and credentials.
            </p>
            
            <blockquote cite="https://www.owasp.org/index.php/Top_10_2013-A8-Cross-Site_Request_Forgery_(CSRF)">
                <p>Attackers can trick victims into performing any state changing operation the victim is authorized to perform, e.g., updating account details, making purchases, logout and even login.</p>
                <footer><a href="https://www.owasp.org/index.php/Top_10_2013-A8-Cross-Site_Request_Forgery_(CSRF)">The OWASP Top 10 2013 Project</a></footer>
            </blockquote>
        </div>
        <div class="seq-test">
            <div class="panel panel-default">
                <div class="panel-heading">Check if the application forms accept POST input coming from a different domain without a correct synchronization (anti-forgery) nonce</div>
                <div class="panel-body">
                    Download <a asp-controller="Store" asp-action="CrossSitePostTest">this test page</a> to your device, open it and click the button on it.
                    <ul>
                        <li>If <risk-exposure is-exposed="true" />, this application will display an order confirmation message.</li>
                        <li>If <risk-exposure is-exposed="false" />, the application will display an error message (HTTP 400), indicating that the application is configured to not accept POST input without the anti-forgery nonce.</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
    </div>
    <div class="col-md-3" role="complementary">
        <nav class="hidden-sm hidden-xs seq-sidebar" id="seq-risks-sidebar" data-spy="affix">
            <ul class="nav">
                <li>
                    <a href="#risks">Risks</a>
                    <ul class="nav">
                        <li><a href="#a1">A1 - Injection</a></li>
                        <li><a href="#a2">A2 - Broken Authentication and Session Management</a></li>
                        <li><a href="#a3">A3 - Sensitive Data Exposure </a></li>
                        <li><a href="#a4">A4 - XML External Entity (XXE)</a></li>
                        <li><a href="#a5">A5 - Broken Access Control</a></li>
                        <li><a href="#a6">A6 - Security Misconfiguration</a></li>
                        <li><a href="#a7">A7 - Cross-Site Scripting (XSS)</a></li>
                        <li><a href="#a8">A8 - Insecure Deserialization</a></li>
                        <li><a href="#a9">A9 - Using Components With Known Vulnerabilities</a></li>
                        <li><a href="#a10">A10 - Insufficient Logging and Monitoring</a></li>
                        <li><a href="#a8-2013">A8 2013 - Cross-Site Request Forgery (CSRF)</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
</div>

@section scripts
{
<script type="text/javascript" src="~/js/risk.js"></script>
}